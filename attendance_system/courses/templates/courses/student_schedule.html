{% extends 'base.html' %}

{% block content %}
<h2>My Schedule</h2>

<!-- ✅ Enrolled Courses Table -->
{% if enrollments %}
    <h4>Enrolled Courses</h4>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Course</th>
                <th>Section</th>
                <th>Type</th>
                <th>Schedule</th>
                <th>Duration</th>
            </tr>
        </thead>
        <tbody>
            {% for enrollment in enrollments %}
            <tr>
                <td>{{ enrollment.section.course.name }}</td>
                <td>{{ enrollment.section.section_number }}</td>
                <td>{{ enrollment.section.section_type }}</td>
                <td>
                    {% if enrollment.section.schedule %}
                        {{ enrollment.section.schedule|date:"l, d M Y H:i A" }}
                    {% else %}
                        Not Scheduled
                    {% endif %}
                </td>
                <td>{{ enrollment.section.duration }} minutes</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- ✅ Weekly Schedule Table -->
    <h4>Weekly Schedule</h4>
    <table class="table table-bordered text-center">
        <thead>
            <tr>
                <th>Time</th>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>Wednesday</th>
                <th>Thursday</th>
                <th>Friday</th>
            </tr>
        </thead>
        <tbody>
            {% for hour in hours %}
            <tr>
                <td>{{ hour }}:00</td>
                {% for day in weekdays %}
                    {% with class_found=False %}
                    {% for enrollment in enrollments %}
                        {% if enrollment.section.schedule|date:"l" == day and enrollment.section.schedule|date:"H" == hour %}
                            {% if not class_found %}
                                <td rowspan="{{ enrollment.section.duration|divisibleby:60|yesno:'2,3,4' }}" 
                                    class="class-box" style="background-color: #f8d7da; padding: 10px; border-radius: 5px;">
                                    <strong>{{ enrollment.section.course.name }}</strong><br>
                                    {{ enrollment.section.section_type }} ({{ enrollment.section.duration }} min)
                                </td>
                                {% with class_found=True %}
                                {% endwith %}
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                    
                    {% if not class_found %}
                        <td></td>  <!-- Empty cell for hours with no class -->
                    {% endif %}
                    {% endwith %}
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>

{% else %}
    <p>You are not enrolled in any courses yet.</p>
{% endif %}

{% endblock %}
