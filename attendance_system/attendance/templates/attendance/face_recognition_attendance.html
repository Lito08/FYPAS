{% extends "base.html" %}

{% block content %}
<h2>Face Recognition Attendance - {{ section.course.name }} ({{ section.section_type }} {{ section.section_number }})</h2>

<p>Please upload your face image to verify your identity and mark attendance.</p>

<form id="face-recognition-form" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="file" id="face-image" accept="image/*" required>
    <button type="submit" class="btn btn-primary">Submit</button>
</form>

<div id="status-message" class="mt-3"></div>

<script>
document.getElementById("face-recognition-form").addEventListener("submit", function(event) {
    event.preventDefault();

    let formData = new FormData();
    formData.append("face_image", document.getElementById("face-image").files[0]);

    fetch("{% url 'face_recognition_attendance' section.id week_number %}", {
        method: "POST",
        body: formData,
        headers: {
            "X-CSRFToken": document.querySelector("[name=csrfmiddlewaretoken]").value
        }
    })
    .then(response => response.json())
    .then(data => {
        let statusMessage = document.getElementById("status-message");
        if (data.status === "success") {
            statusMessage.innerHTML = `<div class="alert alert-success">${data.message}</div>`;
        } else {
            statusMessage.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
        }
    })
    .catch(error => console.error("Error:", error));
});
</script>

{% endblock %}
